<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öΩ Estad√≠sticas de F√∫tbol Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .main-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-warning {
            background: #FF9800;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-info {
            background: #00BCD4;
            color: white;
        }

        .content {
            padding: 30px;
        }

        .teams-config {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .team-config {
            padding: 20px;
            border-radius: 12px;
            border: 3px solid #ddd;
        }

        .team-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .team-name {
            font-size: 24px;
            font-weight: bold;
            flex: 1;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
        }

        .color-picker {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .scoreboard {
            background: linear-gradient(135deg, #434343 0%, #000000 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }

        .score-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin: 20px 0;
        }

        .score-team {
            text-align: center;
        }

        .score-name {
            font-size: 20px;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .score-number {
            font-size: 64px;
            font-weight: bold;
        }

        .score-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        .score-btn {
            width: 40px;
            height: 40px;
            font-size: 24px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .timers {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .timer-box {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 12px;
            border: 3px solid #ddd;
        }

        .timer-display {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .timer-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }

        .stat-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #2196F3;
        }

        .stat-teams {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-team {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            background: #e0e0e0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: #2196F3;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border-radius: 6px;
            padding: 10px;
        }

        .history-item {
            padding: 10px;
            margin-bottom: 8px;
            background: #f5f5f5;
            border-radius: 6px;
            border-left: 4px solid #2196F3;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .tv-mode {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            z-index: 2000;
            color: white;
            padding: 40px;
        }

        .tv-mode.active {
            display: block;
        }

        .tv-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .tv-title {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .tv-teams {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 60px;
            margin: 40px 0;
        }

        .tv-team {
            text-align: center;
        }

        .tv-team-name {
            font-size: 36px;
            margin-bottom: 20px;
        }

        .tv-score {
            font-size: 120px;
            font-weight: bold;
        }

        .tv-time {
            text-align: center;
            font-size: 32px;
            margin: 40px 0;
        }

        .tv-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
            margin-top: 60px;
        }

        .tv-stat {
            text-align: center;
        }

        .tv-stat-title {
            font-size: 24px;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .tv-stat-value {
            font-size: 48px;
            font-weight: bold;
        }

        .close-tv {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            font-size: 36px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-tv:hover {
            background: rgba(255,255,255,0.3);
        }

        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 3000;
        }

        .save-indicator.show {
            opacity: 1;
        }

        .possession-active {
            box-shadow: 0 0 0 3px #4CAF50;
            background: #e8f5e9 !important;
        }

        @media (max-width: 768px) {
            .teams-config, .timers, .stat-teams {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .score-display {
                flex-direction: column;
                gap: 20px;
            }

            .tv-teams {
                flex-direction: column;
                gap: 30px;
            }

            .tv-score {
                font-size: 80px;
            }

            .tv-stats {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .penalties-section {
            display: none;
        }

        .penalties-section.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öΩ ESTAD√çSTICAS DE F√öTBOL PROFESIONAL</h1>
            <div class="main-actions">
                <button class="btn btn-primary" onclick="app.toggleTVMode()">üì∫ Modo TV</button>
                <button class="btn btn-secondary" onclick="app.saveMatch()">üíæ Guardar Partido</button>
                <button class="btn btn-secondary" onclick="document.getElementById('loadFile').click()">üìÇ Cargar Partido</button>
                <button class="btn btn-info" onclick="app.exportJSON()">üì• Exportar JSON</button>
                <button class="btn btn-info" onclick="app.exportCSV()">üì• Exportar CSV</button>
                <button class="btn btn-danger" onclick="app.resetAll()">üîÑ Reinicio Completo</button>
            </div>
            <input type="file" id="loadFile" accept=".json" style="display:none" onchange="app.loadMatch(event)">
        </div>

        <div class="content">
            <!-- Configuraci√≥n de Equipos -->
            <div class="teams-config">
                <div class="team-config" id="teamAConfig">
                    <div class="team-header">
                        <input type="text" class="team-name" id="teamAName" value="Equipo A" onchange="app.updateTeamName('A')">
                        <input type="color" class="color-picker" id="teamAColor" value="#FF5722" onchange="app.updateTeamColor('A')">
                    </div>
                </div>
                <div class="team-config" id="teamBConfig">
                    <div class="team-header">
                        <input type="text" class="team-name" id="teamBName" value="Equipo B" onchange="app.updateTeamName('B')">
                        <input type="color" class="color-picker" id="teamBColor" value="#2196F3" onchange="app.updateTeamColor('B')">
                    </div>
                </div>
            </div>

            <!-- Marcador Principal -->
            <div class="scoreboard">
                <h2>MARCADOR</h2>
                <div class="score-display">
                    <div class="score-team">
                        <div class="score-name" id="scoreNameA">Equipo A</div>
                        <div class="score-number" id="scoreA">0</div>
                        <div class="score-controls">
                            <button class="score-btn" style="background:#4CAF50; color:white" onclick="app.adjustScore('A', 1)">+</button>
                            <button class="score-btn" style="background:#f44336; color:white" onclick="app.adjustScore('A', -1)">-</button>
                        </div>
                    </div>
                    <div style="font-size: 48px;">-</div>
                    <div class="score-team">
                        <div class="score-name" id="scoreNameB">Equipo B</div>
                        <div class="score-number" id="scoreB">0</div>
                        <div class="score-controls">
                            <button class="score-btn" style="background:#4CAF50; color:white" onclick="app.adjustScore('B', 1)">+</button>
                            <button class="score-btn" style="background:#f44336; color:white" onclick="app.adjustScore('B', -1)">-</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cron√≥metros -->
            <div class="timers">
                <div class="timer-box">
                    <h3 style="text-align:center">‚è±Ô∏è PRIMER TIEMPO</h3>
                    <div class="timer-display" id="timer1">00:00</div>
                    <div class="timer-display" id="timer1Add" style="font-size:32px; color:#FF5722">+00:00</div>
                    <div class="timer-controls">
                        <button class="btn btn-primary" id="start1" onclick="app.startTimer(1)">‚ñ∂ Iniciar</button>
                        <button class="btn btn-warning" id="pause1" onclick="app.pauseTimer(1)" style="display:none">‚è∏ Pausar</button>
                        <button class="btn btn-danger" id="finish1" onclick="app.finishTimer(1)" style="display:none">‚èπ Finalizar</button>
                        <button class="btn btn-secondary" onclick="app.setAdditionTime(1)">‚ûï Tiempo Adicional</button>
                    </div>
                </div>
                <div class="timer-box">
                    <h3 style="text-align:center">‚è±Ô∏è SEGUNDO TIEMPO</h3>
                    <div class="timer-display" id="timer2">00:00</div>
                    <div class="timer-display" id="timer2Add" style="font-size:32px; color:#FF5722">+00:00</div>
                    <div class="timer-controls">
                        <button class="btn btn-primary" id="start2" onclick="app.startTimer(2)">‚ñ∂ Iniciar</button>
                        <button class="btn btn-warning" id="pause2" onclick="app.pauseTimer(2)" style="display:none">‚è∏ Pausar</button>
                        <button class="btn btn-danger" id="finish2" onclick="app.finishTimer(2)" style="display:none">‚èπ Finalizar</button>
                        <button class="btn btn-secondary" onclick="app.setAdditionTime(2)">‚ûï Tiempo Adicional</button>
                    </div>
                </div>
            </div>

            <!-- Estad√≠sticas -->
            <div class="stats-grid">
                <!-- Posesi√≥n -->
                <div class="stat-card">
                    <div class="stat-title">‚öΩ POSESI√ìN DEL BAL√ìN</div>
                    <div class="stat-teams">
                        <div class="stat-team" id="possessionA" style="background:#FFE0E0">
                            <div id="possessionNameA">Equipo A</div>
                            <div class="stat-value" id="possessionTimeA">00:00</div>
                            <div id="possessionPercentA" style="font-size:20px; font-weight:bold">0%</div>
                            <button class="btn btn-primary" style="margin-top:10px" onclick="app.startPossession('A')">‚ñ∂ Iniciar</button>
                        </div>
                        <div class="stat-team" id="possessionB" style="background:#E0E0FF">
                            <div id="possessionNameB">Equipo B</div>
                            <div class="stat-value" id="possessionTimeB">00:00</div>
                            <div id="possessionPercentB" style="font-size:20px; font-weight:bold">0%</div>
                            <button class="btn btn-primary" style="margin-top:10px" onclick="app.startPossession('B')">‚ñ∂ Iniciar</button>
                        </div>
                    </div>
                    <div style="text-align:center; margin-top:15px">
                        <button class="btn btn-warning" onclick="app.pausePossession()">‚è∏ Pausar Posesi√≥n</button>
                    </div>
                </div>

                <!-- Llegadas -->
                <div class="stat-card">
                    <div class="stat-title">üéØ LLEGADAS / ATAQUES</div>
                    <div class="tabs">
                        <button class="tab active" onclick="app.switchTab('attacks', 1)">1er Tiempo</button>
                        <button class="tab" onclick="app.switchTab('attacks', 2)">2do Tiempo</button>
                    </div>
                    <div class="tab-content active" id="attacks-1">
                        <div class="stat-teams">
                            <div class="stat-team" id="attacksA1" style="background:#FFE0E0">
                                <div id="attacksNameA1">Equipo A</div>
                                <button class="btn btn-primary" style="margin:10px 0" onclick="app.openAttackModal('A', 1)">+ Agregar Ataque</button>
                                <div class="history-list" id="attacksListA1"></div>
                            </div>
                            <div class="stat-team" id="attacksB1" style="background:#E0E0FF">
                                <div id="attacksNameB1">Equipo B</div>
                                <button class="btn btn-primary" style="margin:10px 0" onclick="app.openAttackModal('B', 1)">+ Agregar Ataque</button>
                                <div class="history-list" id="attacksListB1"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" id="attacks-2">
                        <div class="stat-teams">
                            <div class="stat-team" id="attacksA2" style="background:#FFE0E0">
                                <div id="attacksNameA2">Equipo A</div>
                                <button class="btn btn-primary" style="margin:10px 0" onclick="app.openAttackModal('A', 2)">+ Agregar Ataque</button>
                                <div class="history-list" id="attacksListA2"></div>
                            </div>
                            <div class="stat-team" id="attacksB2" style="background:#E0E0FF">
                                <div id="attacksNameB2">Equipo B</div>
                                <button class="btn btn-primary" style="margin:10px 0" onclick="app.openAttackModal('B', 2)">+ Agregar Ataque</button>
                                <div class="history-list" id="attacksListB2"></div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top:15px; text-align:center; font-weight:bold; font-size:18px">
                        TOTAL: <span id="attacksTotalA">0</span> - <span id="attacksTotalB">0</span>
                    </div>
                </div>

                <!-- Goles -->
                <div class="stat-card">
                    <div class="stat-title">‚öΩ GOLES</div>
                    <div class="tabs">
                        <button class="tab active" onclick="app.switchTab('goals', 1)">1er Tiempo</button>
                        <button class="tab" onclick="app.switchTab('goals', 2)">2do Tiempo</button>
                    </div>
                    <div class="tab-content active" id="goals-1">
                        <div class="stat-teams">
                            <div class="stat-team" id="goalsA1" style="background:#FFE0E0">
                                <div id="goalsNameA1">Equipo A</div>
                                <button class="btn btn-primary" style="margin:10px 0" onclick="app.openGoalModal('A', 1)">+ Agregar Gol</button>
                                <div class="history-list" id="goalsListA1"></div>
                            </div>
                            <div class="stat-team" id="goalsB1" style="background:#E0E0FF">
                                <div id="goalsNameB1">Equipo B</div>
                                <button class="btn btn-primary" style="margin:10px 0" onclick="app.openGoalModal('B', 1)">+ Agregar Gol</button>
                                <div class="history-list" id="goalsListB1"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" id="goals-2">
                        <div class="stat-teams">
                            <div class="stat-team" id="goalsA2" style="background:#FFE0E0">
                                <div id="goalsNameA2">Equipo A</div>
                                <button class="btn btn-primary" style="margin:10px 0" onclick="app.openGoalModal('A', 2)">+ Agregar Gol</button>
                                <div class="history-list" id="goalsListA2"></div>
                            </div>
                            <div class="stat-team" id="goalsB2" style="background:#E0E0FF">
                                <div id="goalsNameB2">Equipo B</div>
                                <button class="btn btn-primary" style="margin:10px 0" onclick="app.openGoalModal('B', 2)">+ Agregar Gol</button>
                                <div class="history-list" id="goalsListB2"></div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top:15px; text-align:center; font-weight:bold; font-size:18px">
                        TOTAL: <span id="goalsTotalA">0</span> - <span id="goalsTotalB">0</span>
                    </div>
                </div>

                <!-- Corners -->
                <div class="stat-card">
                    <div class="stat-title">üö© TIROS DE ESQUINA</div>
                    <div class="tabs">
                        <button class="tab active" onclick="app.switchTab('corners', 1)">1er Tiempo</button>
                        <button class="tab" onclick="app.switchTab('corners', 2)">2do Tiempo</button>
                    </div>
                    <div class="tab-content active" id="corners-1">
                        <div class="stat-teams">
                            <div class="stat-team" id="cornersA1" style="background:#FFE0E0">
                                <div id="cornersNameA1">Equipo A</div>
                                <div class="stat-value" id="cornersValueA1">0</div>
                                <div class="stat-controls">
                                    <button class="score-btn" style="background:#4CAF50; color:white" onclick="app.adjustStat('corners', 'A', 1, 1)">+</button>
                                    <button class="score-btn" style="background:#f44336; color:white" onclick="app.adjustStat('corners', 'A', 1, -1)">-</button>
                                </div>
                            </div>
                            <div class="stat-team" id="cornersB1" style="background:#E0E0FF">
                                <div id="cornersNameB1">Equipo B</div>
                                <div class="stat-value" id="cornersValueB1">0</div>
                                <div class="stat-controls">
                                    <button class="score-btn" style="background:#4CAF50; color:white" onclick="app.adjustStat('corners', 'B', 1, 1)">+</button>
                                    <button class="score-btn" style="background:#f44336; color:white" onclick="app.adjustStat('corners', 'B', 1, -1)">-</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" id="corners-2">
                        <div class="stat-teams">
                            <div class="stat-team" id="cornersA2" style="background:#FFE0E0">
                                <div id="cornersNameA2">Equipo A</div>
                                <div class="stat-value" id="cornersValueA2">0</div>
                                <div class="stat-controls">
                                    <button class="score-btn" style="background:#4CAF50; color:white" onclick="app.adjustStat('corners', 'A', 2, 1)">+</button>
                                    <button class="score-btn" style="background:#f44336; color:white" onclick="app.adjustStat('corners', 'A', 2, -1)">-</button>
                                </div>
                            </div>
                            <div class="stat-team" id="cornersB2" style="background:#E0E0FF">
                                <div id="cornersNameB2">Equipo B</div>
                                <div class="stat-value" id="cornersValueB2">0</div>
                                <div class="stat-controls">
                                    <button class="score-btn" style="background:#4CAF50; color:white" onclick="app.adjustStat('corners', 'B', 2, 1)">+</button>
                                    <button class="score-btn" style="background:#f44336; color:white" onclick="app.adjustStat('corners', 'B', 2, -1)">-</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top:15px; text-align:center; font-weight:bold; font-size:18px">
                        TOTAL: <span id="cornersTotalA">0</span> - <span id="cornersTotalB">0</span>
                    </div>
                </div>

                <!-- Faltas -->
                <div class="stat-card">
                    <div class="stat-title">üü° FALTAS</div>
                    <div class="stat-teams">
                        <div class="stat-team" id="foulsA" style="background:#FFE0E0">
                            <div id="foulsNameA">Equipo A</div>
                            <button class="btn btn-primary" style="margin:10px 0" onclick="app.openFoulModal('A')">+ Agregar Falta</button>
                            <div class="history-list" id="foulsListA"></div>
                        </div>
                        <div class="stat-team" id="foulsB" style="background:#E0E0FF">
                            <div id="foulsNameB">Equipo B</div>
                            <button class="btn btn-primary" style="margin:10px 0" onclick="app.openFoulModal('B')">+ Agregar Falta</button>
                            <div class="history-list" id="foulsListB"></div>
                        </div>
                    </div>
                    <div style="margin-top:15px; text-align:center; font-weight:bold; font-size:18px">
                        TOTAL: <span id="foulsTotalA">0</span> - <span id="foulsTotalB">0</span>
                    </div>
                </div>

                <!-- Offsides -->
                <div class="stat-card">
                    <div class="stat-title">üö´ FUERAS DE LUGAR</div>
                    <div class="tabs">
                        <button class="tab active" onclick="app.switchTab('offsides', 1)">1er Tiempo</button>
                        <button class="tab" onclick="app.switchTab('offsides', 2)">2do Tiempo</button>
                    </div>
                    <div class="tab-content active" id="offsides-1">
                        <div class="stat-teams">
                            <div class="stat-team" id="offsidesA1" style="background:#FFE0E0">
                                <div id="offsidesNameA1">Equipo A</div>
                                <div class="stat-value" id="offsidesValueA1">0</div>
                                <div class="stat-controls">
                                    <button class="score-btn" style="background:#4CAF50; color:white" onclick="app.adjustStat('offsides', 'A', 1, 1)">+</button>
                                    <button class="score-btn" style="background:#f44336; color:white" onclick="app.adjustStat('offsides', 'A', 1, -1)">-</button>
                                </div>
                            </div>
                            <div class="stat-team" id="offsidesB1" style="background:#E0E0FF">
                                <div id="offsidesNameB1">Equipo B</div>
                                <div class="stat-value" id="offsidesValueB1">0</div>
                                <div class="stat-controls">
                                    <button class="score-btn" style="background:#4CAF50; color:white" onclick="app.adjustStat('offsides', 'B', 1, 1)">+</button>
                                    <button class="score-btn" style="background:#f44336; color:white" onclick="app.adjustStat('offsides', 'B', 1, -1)">-</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" id="offsides-2">
                        <div class="stat-teams">
                            <div class="stat-team" id="offsidesA2" style="background:#FFE0E0">
                                <div id="offsidesNameA2">Equipo A</div>
                                <div class="stat-value" id="offsidesValueA2">0</div>
                                <div class="stat-controls">
                                    <button class="score-btn" style="background:#4CAF50; color:white" onclick="app.adjustStat('offsides', 'A', 2, 1)">+</button>
                                    <button class="score-btn" style="background:#f44336; color:white" onclick="app.adjustStat('offsides', 'A', 2, -1)">-</button>
                                </div>
                            </div>
                            <div class="stat-team" id="offsidesB2" style="background:#E0E0FF">
                                <div id="offsidesNameB2">Equipo B</div>
                                <div class="stat-value" id="offsidesValueB2">0</div>
                                <div class="stat-controls">
                                    <button class="score-btn" style="background:#4CAF50; color:white" onclick="app.adjustStat('offsides', 'B', 2, 1)">+</button>
                                    <button class="score-btn" style="background:#f44336; color:white" onclick="app.adjustStat('offsides', 'B', 2, -1)">-</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top:15px; text-align:center; font-weight:bold; font-size:18px">
                        TOTAL: <span id="offsidesTotalA">0</span> - <span id="offsidesTotalB">0</span>
                    </div>
                </div>

                <!-- Tarjetas -->
                <div class="stat-card">
                    <div class="stat-title">üü®üü• TARJETAS</div>
                    <div class="stat-teams">
                        <div class="stat-team" id="cardsA" style="background:#FFE0E0">
                            <div id="cardsNameA">Equipo A</div>
                            <button class="btn btn-primary" style="margin:10px 0" onclick="app.openCardModal('A')">+ Agregar Tarjeta</button>
                            <div style="display:flex; gap:10px; justify-content:center; margin:10px 0">
                                <div>üü® <span id="yellowCardsA">0</span></div>
                                <div>üü• <span id="redCardsA">0</span></div>
                            </div>
                            <div class="history-list" id="cardsListA"></div>
                        </div>
                        <div class="stat-team" id="cardsB" style="background:#E0E0FF">
                            <div id="cardsNameB">Equipo B</div>
                            <button class="btn btn-primary" style="margin:10px 0" onclick="app.openCardModal('B')">+ Agregar Tarjeta</button>
                            <div style="display:flex; gap:10px; justify-content:center; margin:10px 0">
                                <div>üü® <span id="yellowCardsB">0</span></div>
                                <div>üü• <span id="redCardsB">0</span></div>
                            </div>
                            <div class="history-list" id="cardsListB"></div>
                        </div>
                    </div>
                </div>

                <!-- Cambios -->
                <div class="stat-card">
                    <div class="stat-title">üîÑ CAMBIOS / SUSTITUCIONES</div>
                    <div class="stat-teams">
                        <div class="stat-team" id="subsA" style="background:#FFE0E0">
                            <div id="subsNameA">Equipo A</div>
                            <button class="btn btn-primary" style="margin:10px 0" onclick="app.openSubModal('A')">+ Agregar Cambio</button>
                            <div class="history-list" id="subsListA"></div>
                            <div style="margin-top:10px; font-weight:bold">Total: <span id="subsTotalA">0</span></div>
                        </div>
                        <div class="stat-team" id="subsB" style="background:#E0E0FF">
                            <div id="subsNameB">Equipo B</div>
                            <button class="btn btn-primary" style="margin:10px 0" onclick="app.openSubModal('B')">+ Agregar Cambio</button>
                            <div class="history-list" id="subsListB"></div>
                            <div style="margin-top:10px; font-weight:bold">Total: <span id="subsTotalB">0</span></div>
                        </div>
                    </div>
                </div>

                <!-- Penales -->
                <div class="stat-card">
                    <div class="stat-title">ü•Ö TANDA DE PENALES</div>
                    <div style="text-align:center; margin-bottom:15px">
                        <button class="btn btn-secondary" onclick="app.togglePenalties()">‚ö° Activar/Desactivar Penales</button>
                    </div>
                    <div class="penalties-section" id="penaltiesSection">
                        <div class="stat-teams">
                            <div class="stat-team" id="penaltiesA" style="background:#FFE0E0">
                                <div id="penaltiesNameA">Equipo A</div>
                                <button class="btn btn-primary" style="margin:10px 0" onclick="app.openPenaltyModal('A')">+ Agregar Penal</button>
                                <div style="display:flex; gap:10px; justify-content:center; margin:10px 0">
                                    <div>‚öΩ <span id="penaltiesGoalA">0</span></div>
                                    <div>‚ùå <span id="penaltiesMissA">0</span></div>
                                </div>
                                <div class="history-list" id="penaltiesListA"></div>
                            </div>
                            <div class="stat-team" id="penaltiesB" style="background:#E0E0FF">
                                <div id="penaltiesNameB">Equipo B</div>
                                <button class="btn btn-primary" style="margin:10px 0" onclick="app.openPenaltyModal('B')">+ Agregar Penal</button>
                                <div style="display:flex; gap:10px; justify-content:center; margin:10px 0">
                                    <div>‚öΩ <span id="penaltiesGoalB">0</span></div>
                                    <div>‚ùå <span id="penaltiesMissB">0</span></div>
                                </div>
                                <div class="history-list" id="penaltiesListB"></div>
                            </div>
                        </div>
                        <div style="text-align:center; margin-top:15px">
                            <button class="btn btn-danger" onclick="app.resetPenalties()">üîÑ Reiniciar Penales</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Ataques -->
    <div class="modal" id="attackModal">
        <div class="modal-content">
            <div class="modal-title">üéØ Agregar Ataque</div>
            <div class="form-group">
                <label class="form-label">Descripci√≥n del Ataque:</label>
                <input type="text" class="form-input" id="attackDescription" placeholder="Ej: Contragolpe, tiro libre, etc.">
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="app.closeModal('attackModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="app.addAttack()">Agregar Ataque</button>
            </div>
        </div>
    </div>

    <!-- Modal para Goles -->
    <div class="modal" id="goalModal">
        <div class="modal-content">
            <div class="modal-title">‚öΩ Agregar Gol</div>
            <div class="form-group">
                <label class="form-label">N√∫mero de Jugador:</label>
                <input type="number" class="form-input" id="goalPlayer" min="1" max="99">
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="app.closeModal('goalModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="app.addGoal()">Agregar Gol</button>
            </div>
        </div>
    </div>

    <!-- Modal para Faltas -->
    <div class="modal" id="foulModal">
        <div class="modal-content">
            <div class="modal-title">üü° Agregar Falta</div>
            <div class="form-group">
                <label class="form-label">Descripci√≥n de la Falta:</label>
                <input type="text" class="form-input" id="foulDescription">
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="app.closeModal('foulModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="app.addFoul()">Agregar Falta</button>
            </div>
        </div>
    </div>

    <!-- Modal para Tarjetas -->
    <div class="modal" id="cardModal">
        <div class="modal-content">
            <div class="modal-title">üü®üü• Agregar Tarjeta</div>
            <div class="form-group">
                <label class="form-label">Tipo de Tarjeta:</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="cardType" value="yellow" id="yellowCard" checked>
                        <label for="yellowCard">üü® Amarilla</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="cardType" value="red" id="redCard">
                        <label for="redCard">üü• Roja</label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">N√∫mero de Jugador:</label>
                <input type="number" class="form-input" id="cardPlayer" min="1" max="99">
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="app.closeModal('cardModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="app.addCard()">Agregar Tarjeta</button>
            </div>
        </div>
    </div>

    <!-- Modal para Cambios -->
    <div class="modal" id="subModal">
        <div class="modal-content">
            <div class="modal-title">üîÑ Agregar Cambio</div>
            <div class="form-group">
                <label class="form-label">Jugador que Sale (N√∫mero):</label>
                <input type="number" class="form-input" id="subOut" min="1" max="99">
            </div>
            <div class="form-group">
                <label class="form-label">Jugador que Entra (N√∫mero):</label>
                <input type="number" class="form-input" id="subIn" min="1" max="99">
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="app.closeModal('subModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="app.addSubstitution()">Agregar Cambio</button>
            </div>
        </div>
    </div>

    <!-- Modal para Penales -->
    <div class="modal" id="penaltyModal">
        <div class="modal-content">
            <div class="modal-title">ü•Ö Agregar Penal</div>
            <div class="form-group">
                <label class="form-label">N√∫mero de Jugador:</label>
                <input type="number" class="form-input" id="penaltyPlayer" min="1" max="99">
            </div>
            <div class="form-group">
                <label class="form-label">Resultado:</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="penaltyResult" value="goal" id="penaltyGoal" checked>
                        <label for="penaltyGoal">‚öΩ Gol</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="penaltyResult" value="miss" id="penaltyMiss">
                        <label for="penaltyMiss">‚ùå Falla</label>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="app.closeModal('penaltyModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="app.addPenalty()">Agregar Penal</button>
            </div>
        </div>
    </div>

    <!-- Modal para Tiempo Adicional -->
    <div class="modal" id="additionModal">
        <div class="modal-content">
            <div class="modal-title">‚ûï Configurar Tiempo Adicional</div>
            <div class="form-group">
                <label class="form-label">Minutos de Adici√≥n:</label>
                <input type="number" class="form-input" id="additionMinutes" min="0" max="15" value="0">
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="app.closeModal('additionModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="app.applyAdditionTime()">Aplicar</button>
            </div>
        </div>
    </div>

    <!-- Modo TV -->
    <div class="tv-mode" id="tvMode">
        <button class="close-tv" onclick="app.toggleTVMode()">‚úï</button>
        <div class="tv-header">
            <div class="tv-title">‚öΩ PARTIDO EN VIVO</div>
        </div>
        <div class="tv-teams">
            <div class="tv-team">
                <div class="tv-team-name" id="tvTeamA">Equipo A</div>
                <div class="tv-score" id="tvScoreA">0</div>
            </div>
            <div style="font-size: 80px;">-</div>
            <div class="tv-team">
                <div class="tv-team-name" id="tvTeamB">Equipo B</div>
                <div class="tv-score" id="tvScoreB">0</div>
            </div>
        </div>
        <div class="tv-time" id="tvTime">00:00 - 1er Tiempo</div>
        <div class="tv-stats">
            <div class="tv-stat">
                <div class="tv-stat-title">POSESI√ìN</div>
                <div class="tv-stat-value"><span id="tvPossA">0%</span> - <span id="tvPossB">0%</span></div>
            </div>
            <div class="tv-stat">
                <div class="tv-stat-title">LLEGADAS</div>
                <div class="tv-stat-value"><span id="tvAttA">0</span> - <span id="tvAttB">0</span></div>
            </div>
            <div class="tv-stat">
                <div class="tv-stat-title">CORNERS</div>
                <div class="tv-stat-value"><span id="tvCorA">0</span> - <span id="tvCorB">0</span></div>
            </div>
        </div>
    </div>

    <!-- Indicador de Guardado -->
    <div class="save-indicator" id="saveIndicator">
        ‚úì Guardado autom√°ticamente
    </div>

    <script>
        const app = {
            data: {
                version: '1.0',
                teams: {
                    A: { name: 'Equipo A', color: '#FF5722' },
                    B: { name: 'Equipo B', color: '#2196F3' }
                },
                score: { A: 0, B: 0 },
                timers: {
                    1: { seconds: 0, additionSeconds: 0, additionMinutes: 0, running: false, finished: false, interval: null },
                    2: { seconds: 0, additionSeconds: 0, additionMinutes: 0, running: false, finished: false, interval: null }
                },
                possession: {
                    A: { seconds: 0, active: false, interval: null },
                    B: { seconds: 0, active: false, interval: null }
                },
                stats: {
                    corners: { A: { 1: 0, 2: 0 }, B: { 1: 0, 2: 0 } },
                    offsides: { A: { 1: 0, 2: 0 }, B: { 1: 0, 2: 0 } }
                },
                attacks: { A: { 1: [], 2: [] }, B: { 1: [], 2: [] } },
                goals: { A: { 1: [], 2: [] }, B: { 1: [], 2: [] } },
                fouls: { A: [], B: [] },
                cards: { A: [], B: [] },
                substitutions: { A: [], B: [] },
                penalties: { 
                    active: false,
                    A: [], 
                    B: [] 
                }
            },
            currentAttackTeam: null,
            currentAttackHalf: null,
            currentGoalTeam: null,
            currentGoalHalf: null,
            currentFoulTeam: null,
            currentCardTeam: null,
            currentSubTeam: null,
            currentPenaltyTeam: null,
            currentAdditionTimer: null,
            tvInterval: null,

            init() {
                this.loadFromSession();
                this.updateAllDisplays();
                this.updateTeamColors();
            },

            updateTeamName(team) {
                const name = document.getElementById(`team${team}Name`).value.trim();
                if (name) {
                    this.data.teams[team].name = name;
                    this.updateAllDisplays();
                    this.save();
                }
            },

            updateTeamColor(team) {
                const color = document.getElementById(`team${team}Color`).value;
                this.data.teams[team].color = color;
                this.updateTeamColors();
                this.save();
            },

            updateTeamColors() {
                const colorA = this.data.teams.A.color;
                const colorB = this.data.teams.B.color;

                document.getElementById('teamAConfig').style.backgroundColor = colorA + '20';
                document.getElementById('teamBConfig').style.backgroundColor = colorB + '20';

                const hexToRgb = (hex) => {
                    const r = parseInt(hex.slice(1, 3), 16);
                    const g = parseInt(hex.slice(3, 5), 16);
                    const b = parseInt(hex.slice(5, 7), 16);
                    return `${r}, ${g}, ${b}`;
                };

                document.querySelectorAll('[id*="A"]').forEach(el => {
                    if (el.classList.contains('stat-team') || el.id.includes('attacks') || 
                        el.id.includes('corners') || el.id.includes('offsides') || 
                        el.id.includes('goals') || el.id.includes('fouls') || 
                        el.id.includes('cards') || el.id.includes('subs') || 
                        el.id.includes('penalties') || el.id.includes('possession')) {
                        el.style.backgroundColor = `rgba(${hexToRgb(colorA)}, 0.15)`;
                    }
                });

                document.querySelectorAll('[id*="B"]').forEach(el => {
                    if (el.classList.contains('stat-team') || el.id.includes('attacks') || 
                        el.id.includes('corners') || el.id.includes('offsides') || 
                        el.id.includes('goals') || el.id.includes('fouls') || 
                        el.id.includes('cards') || el.id.includes('subs') || 
                        el.id.includes('penalties') || el.id.includes('possession')) {
                        el.style.backgroundColor = `rgba(${hexToRgb(colorB)}, 0.15)`;
                    }
                });
            },

            adjustScore(team, delta) {
                this.data.score[team] = Math.max(0, this.data.score[team] + delta);
                this.updateScoreboard();
                this.save();
            },

            updateScoreboard() {
                document.getElementById('scoreA').textContent = this.data.score.A;
                document.getElementById('scoreB').textContent = this.data.score.B;
                document.getElementById('scoreNameA').textContent = this.data.teams.A.name;
                document.getElementById('scoreNameB').textContent = this.data.teams.B.name;
            },

            startTimer(half) {
                if (this.data.timers[half].running || this.data.timers[half].finished) return;
                
                this.data.timers[half].running = true;
                document.getElementById(`start${half}`).style.display = 'none';
                document.getElementById(`pause${half}`).style.display = 'inline-block';
                document.getElementById(`finish${half}`).style.display = 'inline-block';

                this.data.timers[half].interval = setInterval(() => {
                    if (this.data.timers[half].seconds < 2700) {
                        this.data.timers[half].seconds++;
                    } else {
                        this.data.timers[half].additionSeconds++;
                    }
                    this.updateTimerDisplay(half);
                    this.save();
                }, 1000);
            },

            pauseTimer(half) {
                const timer = this.data.timers[half];
                if (timer.running) {
                    clearInterval(timer.interval);
                    timer.running = false;
                    document.getElementById(`pause${half}`).textContent = '‚ñ∂ Reanudar';
                } else if (!timer.finished) {
                    this.startTimer(half);
                    document.getElementById(`pause${half}`).textContent = '‚è∏ Pausar';
                }
            },

            finishTimer(half) {
                clearInterval(this.data.timers[half].interval);
                this.data.timers[half].running = false;
                this.data.timers[half].finished = true;
                document.getElementById(`pause${half}`).style.display = 'none';
                document.getElementById(`finish${half}`).style.display = 'none';
                this.save();
            },

            updateTimerDisplay(half) {
                const timer = this.data.timers[half];
                const mins = Math.floor(timer.seconds / 60);
                const secs = timer.seconds % 60;
                document.getElementById(`timer${half}`).textContent = 
                    `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;

                if (timer.additionSeconds > 0) {
                    const addMins = Math.floor(timer.additionSeconds / 60);
                    const addSecs = timer.additionSeconds % 60;
                    document.getElementById(`timer${half}Add`).textContent = 
                        `+${String(addMins).padStart(2, '0')}:${String(addSecs).padStart(2, '0')}`;
                } else {
                    document.getElementById(`timer${half}Add`).textContent = '+00:00';
                }
            },

            setAdditionTime(half) {
                this.currentAdditionTimer = half;
                document.getElementById('additionMinutes').value = this.data.timers[half].additionMinutes;
                this.openModal('additionModal');
            },

            applyAdditionTime() {
                const mins = parseInt(document.getElementById('additionMinutes').value) || 0;
                this.data.timers[this.currentAdditionTimer].additionMinutes = mins;
                this.closeModal('additionModal');
                this.save();
            },

            startPossession(team) {
                const other = team === 'A' ? 'B' : 'A';
                
                if (this.data.possession[other].active) {
                    clearInterval(this.data.possession[other].interval);
                    this.data.possession[other].active = false;
                    document.getElementById(`possession${other}`).classList.remove('possession-active');
                }

                if (this.data.possession[team].active) return;

                this.data.possession[team].active = true;
                document.getElementById(`possession${team}`).classList.add('possession-active');

                this.data.possession[team].interval = setInterval(() => {
                    this.data.possession[team].seconds++;
                    this.updatePossessionDisplay();
                    this.save();
                }, 1000);
            },

            pausePossession() {
                ['A', 'B'].forEach(team => {
                    if (this.data.possession[team].active) {
                        clearInterval(this.data.possession[team].interval);
                        this.data.possession[team].active = false;
                        document.getElementById(`possession${team}`).classList.remove('possession-active');
                    }
                });
                this.save();
            },

            updatePossessionDisplay() {
                const totalSeconds = this.data.possession.A.seconds + this.data.possession.B.seconds;
                
                ['A', 'B'].forEach(team => {
                    const seconds = this.data.possession[team].seconds;
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    document.getElementById(`possessionTime${team}`).textContent = 
                        `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
                    
                    const percent = totalSeconds > 0 ? Math.round((seconds / totalSeconds) * 100) : 0;
                    document.getElementById(`possessionPercent${team}`).textContent = `${percent}%`;
                });
            },

            openAttackModal(team, half) {
                this.currentAttackTeam = team;
                this.currentAttackHalf = half;
                document.getElementById('attackDescription').value = '';
                this.openModal('attackModal');
            },

            addAttack() {
                const description = document.getElementById('attackDescription').value.trim();
                if (!description) {
                    alert('Por favor ingrese la descripci√≥n del ataque');
                    return;
                }

                const time = this.getCurrentTime(this.currentAttackHalf);
                const attack = {
                    description: description,
                    time: time,
                    timestamp: Date.now()
                };

                this.data.attacks[this.currentAttackTeam][this.currentAttackHalf].push(attack);
                this.updateAttacksDisplay();
                this.closeModal('attackModal');
                this.save();
            },

            updateAttacksDisplay() {
                ['A', 'B'].forEach(team => {
                    [1, 2].forEach(half => {
                        const list = document.getElementById(`attacksList${team}${half}`);
                        list.innerHTML = '';
                        this.data.attacks[team][half].forEach(attack => {
                            const item = document.createElement('div');
                            item.className = 'history-item';
                            item.innerHTML = `üéØ ${attack.description} - ${attack.time}`;
                            list.appendChild(item);
                        });
                    });
                    const totalAttacks = this.data.attacks[team][1].length + this.data.attacks[team][2].length;
                    document.getElementById(`attacksTotal${team}`).textContent = totalAttacks;
                });
            },

            adjustStat(stat, team, half, delta) {
                this.data.stats[stat][team][half] = Math.max(0, this.data.stats[stat][team][half] + delta);
                this.updateStatDisplay(stat);
                this.save();
            },

            updateStatDisplay(stat) {
                ['A', 'B'].forEach(team => {
                    [1, 2].forEach(half => {
                        const value = this.data.stats[stat][team][half];
                        document.getElementById(`${stat}Value${team}${half}`).textContent = value;
                    });
                    const total = this.data.stats[stat][team][1] + this.data.stats[stat][team][2];
                    document.getElementById(`${stat}Total${team}`).textContent = total;
                });
            },

            openGoalModal(team, half) {
                this.currentGoalTeam = team;
                this.currentGoalHalf = half;
                document.getElementById('goalPlayer').value = '';
                this.openModal('goalModal');
            },

            addGoal() {
                const player = document.getElementById('goalPlayer').value;
                if (!player) {
                    alert('Por favor ingrese el n√∫mero de jugador');
                    return;
                }

                const time = this.getCurrentTime(this.currentGoalHalf);
                const goal = {
                    player: player,
                    time: time,
                    half: this.currentGoalHalf,
                    timestamp: Date.now()
                };

                this.data.goals[this.currentGoalTeam][this.currentGoalHalf].push(goal);
                this.data.score[this.currentGoalTeam]++;
                
                this.updateGoalsDisplay();
                this.updateScoreboard();
                this.closeModal('goalModal');
                this.save();
            },

            updateGoalsDisplay() {
                ['A', 'B'].forEach(team => {
                    [1, 2].forEach(half => {
                        const list = document.getElementById(`goalsList${team}${half}`);
                        list.innerHTML = '';
                        this.data.goals[team][half].forEach((goal, index) => {
                            const item = document.createElement('div');
                            item.className = 'history-item';
                            item.innerHTML = `‚öΩ Jugador #${goal.player} - ${goal.time}`;
                            list.appendChild(item);
                        });
                    });
                    const totalGoals = this.data.goals[team][1].length + this.data.goals[team][2].length;
                    document.getElementById(`goalsTotal${team}`).textContent = totalGoals;
                });
            },

            openFoulModal(team) {
                this.currentFoulTeam = team;
                document.getElementById('foulDescription').value = '';
                this.openModal('foulModal');
            },

            addFoul() {
                const description = document.getElementById('foulDescription').value.trim();
                if (!description) {
                    alert('Por favor ingrese la descripci√≥n de la falta');
                    return;
                }

                const currentHalf = this.data.timers[1].running || !this.data.timers[1].finished ? 1 : 2;
                const time = this.getCurrentTime(currentHalf);
                
                const foul = {
                    description: description,
                    time: time,
                    timestamp: Date.now()
                };

                this.data.fouls[this.currentFoulTeam].push(foul);
                this.updateFoulsDisplay();
                this.closeModal('foulModal');
                this.save();
            },

            updateFoulsDisplay() {
                ['A', 'B'].forEach(team => {
                    const list = document.getElementById(`foulsList${team}`);
                    list.innerHTML = '';
                    this.data.fouls[team].forEach(foul => {
                        const item = document.createElement('div');
                        item.className = 'history-item';
                        item.innerHTML = `${foul.description} - ${foul.time}`;
                        list.appendChild(item);
                    });
                    document.getElementById(`foulsTotal${team}`).textContent = this.data.fouls[team].length;
                });
            },

            openCardModal(team) {
                this.currentCardTeam = team;
                document.getElementById('cardPlayer').value = '';
                document.getElementById('yellowCard').checked = true;
                this.openModal('cardModal');
            },

            addCard() {
                const player = document.getElementById('cardPlayer').value;
                if (!player) {
                    alert('Por favor ingrese el n√∫mero de jugador');
                    return;
                }

                const type = document.querySelector('input[name="cardType"]:checked').value;
                const currentHalf = this.data.timers[1].running || !this.data.timers[1].finished ? 1 : 2;
                const time = this.getCurrentTime(currentHalf);

                const card = {
                    type: type,
                    player: player,
                    time: time,
                    timestamp: Date.now()
                };

                this.data.cards[this.currentCardTeam].push(card);
                this.updateCardsDisplay();
                this.closeModal('cardModal');
                this.save();
            },

            updateCardsDisplay() {
                ['A', 'B'].forEach(team => {
                    const list = document.getElementById(`cardsList${team}`);
                    list.innerHTML = '';
                    
                    let yellowCount = 0;
                    let redCount = 0;

                    this.data.cards[team].forEach(card => {
                        const item = document.createElement('div');
                        item.className = 'history-item';
                        const emoji = card.type === 'yellow' ? 'üü®' : 'üü•';
                        item.innerHTML = `${emoji} Jugador #${card.player} - ${card.time}`;
                        list.appendChild(item);

                        if (card.type === 'yellow') yellowCount++;
                        else redCount++;
                    });

                    document.getElementById(`yellowCards${team}`).textContent = yellowCount;
                    document.getElementById(`redCards${team}`).textContent = redCount;
                });
            },

            openSubModal(team) {
                this.currentSubTeam = team;
                document.getElementById('subOut').value = '';
                document.getElementById('subIn').value = '';
                this.openModal('subModal');
            },

            addSubstitution() {
                const playerOut = document.getElementById('subOut').value;
                const playerIn = document.getElementById('subIn').value;
                
                if (!playerOut || !playerIn) {
                    alert('Por favor ingrese ambos n√∫meros de jugadores');
                    return;
                }

                const currentHalf = this.data.timers[1].running || !this.data.timers[1].finished ? 1 : 2;
                const time = this.getCurrentTime(currentHalf);

                const sub = {
                    playerOut: playerOut,
                    playerIn: playerIn,
                    time: time,
                    timestamp: Date.now()
                };

                this.data.substitutions[this.currentSubTeam].push(sub);
                this.updateSubstitutionsDisplay();
                this.closeModal('subModal');
                this.save();
            },

            updateSubstitutionsDisplay() {
                ['A', 'B'].forEach(team => {
                    const list = document.getElementById(`subsList${team}`);
                    list.innerHTML = '';
                    
                    this.data.substitutions[team].forEach(sub => {
                        const item = document.createElement('div');
                        item.className = 'history-item';
                        item.innerHTML = `üîÑ #${sub.playerOut} ‚Üí #${sub.playerIn} - ${sub.time}`;
                        list.appendChild(item);
                    });

                    document.getElementById(`subsTotal${team}`).textContent = this.data.substitutions[team].length;
                });
            },

            togglePenalties() {
                this.data.penalties.active = !this.data.penalties.active;
                const section = document.getElementById('penaltiesSection');
                if (this.data.penalties.active) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
                this.save();
            },

            openPenaltyModal(team) {
                this.currentPenaltyTeam = team;
                document.getElementById('penaltyPlayer').value = '';
                document.getElementById('penaltyGoal').checked = true;
                this.openModal('penaltyModal');
            },

            addPenalty() {
                const player = document.getElementById('penaltyPlayer').value;
                if (!player) {
                    alert('Por favor ingrese el n√∫mero de jugador');
                    return;
                }

                const result = document.querySelector('input[name="penaltyResult"]:checked').value;
                
                const penalty = {
                    player: player,
                    result: result,
                    order: this.data.penalties[this.currentPenaltyTeam].length + 1,
                    timestamp: Date.now()
                };

                this.data.penalties[this.currentPenaltyTeam].push(penalty);
                this.updatePenaltiesDisplay();
                this.closeModal('penaltyModal');
                this.save();
            },

            updatePenaltiesDisplay() {
                ['A', 'B'].forEach(team => {
                    const list = document.getElementById(`penaltiesList${team}`);
                    list.innerHTML = '';
                    
                    let goalCount = 0;
                    let missCount = 0;

                    this.data.penalties[team].forEach(penalty => {
                        const item = document.createElement('div');
                        item.className = 'history-item';
                        const emoji = penalty.result === 'goal' ? '‚öΩ' : '‚ùå';
                        item.innerHTML = `${penalty.order}. ${emoji} Jugador #${penalty.player}`;
                        list.appendChild(item);

                        if (penalty.result === 'goal') goalCount++;
                        else missCount++;
                    });

                    document.getElementById(`penaltiesGoal${team}`).textContent = goalCount;
                    document.getElementById(`penaltiesMiss${team}`).textContent = missCount;
                });
            },

            resetPenalties() {
                if (confirm('¬øEst√° seguro que desea reiniciar la tanda de penales?')) {
                    this.data.penalties.A = [];
                    this.data.penalties.B = [];
                    this.updatePenaltiesDisplay();
                    this.save();
                    alert('Tanda de penales reiniciada');
                }
            },

            getCurrentTime(half) {
                const timer = this.data.timers[half];
                const mins = Math.floor(timer.seconds / 60);
                const secs = timer.seconds % 60;
                let timeStr = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
                
                if (timer.additionSeconds > 0) {
                    const addMins = Math.floor(timer.additionSeconds / 60);
                    const addSecs = timer.additionSeconds % 60;
                    timeStr += ` +${String(addMins).padStart(2, '0')}:${String(addSecs).padStart(2, '0')}`;
                }
                
                timeStr += ` (${half}T)`;
                return timeStr;
            },

            switchTab(section, tab) {
                const tabs = document.querySelectorAll(`#${section}-1, #${section}-2`).forEach(el => {
                    el.classList.remove('active');
                });
                
                document.querySelectorAll('.tab').forEach(el => {
                    if (el.onclick && el.onclick.toString().includes(`'${section}'`)) {
                        el.classList.remove('active');
                    }
                });

                document.getElementById(`${section}-${tab}`).classList.add('active');
                event.target.classList.add('active');
            },

            toggleTVMode() {
                const tvMode = document.getElementById('tvMode');
                tvMode.classList.toggle('active');
                
                if (tvMode.classList.contains('active')) {
                    this.updateTVDisplay();
                    this.tvInterval = setInterval(() => this.updateTVDisplay(), 1000);
                } else {
                    clearInterval(this.tvInterval);
                }
            },

            updateTVDisplay() {
                document.getElementById('tvTeamA').textContent = this.data.teams.A.name;
                document.getElementById('tvTeamB').textContent = this.data.teams.B.name;
                document.getElementById('tvScoreA').textContent = this.data.score.A;
                document.getElementById('tvScoreB').textContent = this.data.score.B;

                let currentHalf = 0;
                let timeStr = '00:00';
                
                if (this.data.timers[1].running || (!this.data.timers[1].finished && this.data.timers[1].seconds > 0)) {
                    currentHalf = 1;
                    const timer = this.data.timers[1];
                    const mins = Math.floor(timer.seconds / 60);
                    const secs = timer.seconds % 60;
                    timeStr = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
                    if (timer.additionSeconds > 0) {
                        const addMins = Math.floor(timer.additionSeconds / 60);
                        const addSecs = timer.additionSeconds % 60;
                        timeStr += ` +${String(addMins).padStart(2, '0')}:${String(addSecs).padStart(2, '0')}`;
                    }
                } else if (this.data.timers[2].running || this.data.timers[2].seconds > 0) {
                    currentHalf = 2;
                    const timer = this.data.timers[2];
                    const mins = Math.floor(timer.seconds / 60);
                    const secs = timer.seconds % 60;
                    timeStr = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
                    if (timer.additionSeconds > 0) {
                        const addMins = Math.floor(timer.additionSeconds / 60);
                        const addSecs = timer.additionSeconds % 60;
                        timeStr += ` +${String(addMins).padStart(2, '0')}:${String(addSecs).padStart(2, '0')}`;
                    }
                }

                const halfText = currentHalf === 1 ? '1er Tiempo' : currentHalf === 2 ? '2do Tiempo' : 'Sin iniciar';
                document.getElementById('tvTime').textContent = `${timeStr} - ${halfText}`;

                const totalPoss = this.data.possession.A.seconds + this.data.possession.B.seconds;
                const possA = totalPoss > 0 ? Math.round((this.data.possession.A.seconds / totalPoss) * 100) : 0;
                const possB = totalPoss > 0 ? Math.round((this.data.possession.B.seconds / totalPoss) * 100) : 0;
                document.getElementById('tvPossA').textContent = `${possA}%`;
                document.getElementById('tvPossB').textContent = `${possB}%`;

                const attacksA = this.data.attacks.A[1].length + this.data.attacks.A[2].length;
                const attacksB = this.data.attacks.B[1].length + this.data.attacks.B[2].length;
                document.getElementById('tvAttA').textContent = attacksA;
                document.getElementById('tvAttB').textContent = attacksB;

                const cornersA = this.data.stats.corners.A[1] + this.data.stats.corners.A[2];
                const cornersB = this.data.stats.corners.B[1] + this.data.stats.corners.B[2];
                document.getElementById('tvCorA').textContent = cornersA;
                document.getElementById('tvCorB').textContent = cornersB;
            },

            saveMatch() {
                const matchData = {
                    version: this.data.version,
                    savedAt: new Date().toISOString(),
                    ...this.data
                };

                const teamAName = this.data.teams.A.name.replace(/\s+/g, '_');
                const teamBName = this.data.teams.B.name.replace(/\s+/g, '_');
                const date = new Date().toISOString().split('T')[0];
                const filename = `partido_${teamAName}_vs_${teamBName}_${date}.json`;

                const blob = new Blob([JSON.stringify(matchData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);

                alert('‚úì Partido guardado exitosamente');
            },

            loadMatch(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const matchData = JSON.parse(e.target.result);
                        
                        if (confirm('¬øEst√° seguro que desea cargar este partido? Se sobrescribir√°n los datos actuales.')) {
                            this.data = matchData;
                            this.updateAllDisplays();
                            this.save();
                            alert('‚úì Partido cargado exitosamente');
                        }
                    } catch (error) {
                        alert('‚ùå Error al cargar el archivo. Formato inv√°lido.');
                        console.error(error);
                    }
                };
                reader.readAsText(file);
            },

            exportJSON() {
                const exportData = {
                    version: this.data.version,
                    exportedAt: new Date().toISOString(),
                    match: this.data
                };

                const teamAName = this.data.teams.A.name.replace(/\s+/g, '_');
                const teamBName = this.data.teams.B.name.replace(/\s+/g, '_');
                const filename = `estadisticas_${teamAName}_vs_${teamBName}.json`;

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);

                alert('‚úì Estad√≠sticas exportadas en JSON');
            },

            exportCSV() {
                const teamAName = this.data.teams.A.name;
                const teamBName = this.data.teams.B.name;

                let csv = 'Categor√≠a,Equipo A,Equipo B\n';
                csv += `Goles Totales,${this.data.score.A},${this.data.score.B}\n`;
                csv += `Posesi√≥n (segundos),${this.data.possession.A.seconds},${this.data.possession.B.seconds}\n`;
                csv += `Llegadas 1er Tiempo,${this.data.attacks.A[1].length},${this.data.attacks.B[1].length}\n`;
                csv += `Llegadas 2do Tiempo,${this.data.attacks.A[2].length},${this.data.attacks.B[2].length}\n`;
                csv += `Llegadas Total,${this.data.attacks.A[1].length + this.data.attacks.A[2].length},${this.data.attacks.B[1].length + this.data.attacks.B[2].length}\n`;
                csv += `Corners 1er Tiempo,${this.data.stats.corners.A[1]},${this.data.stats.corners.B[1]}\n`;
                csv += `Corners 2do Tiempo,${this.data.stats.corners.A[2]},${this.data.stats.corners.B[2]}\n`;
                csv += `Corners Total,${this.data.stats.corners.A[1] + this.data.stats.corners.A[2]},${this.data.stats.corners.B[1] + this.data.stats.corners.B[2]}\n`;
                csv += `Offsides 1er Tiempo,${this.data.stats.offsides.A[1]},${this.data.stats.offsides.B[1]}\n`;
                csv += `Offsides 2do Tiempo,${this.data.stats.offsides.A[2]},${this.data.stats.offsides.B[2]}\n`;
                csv += `Offsides Total,${this.data.stats.offsides.A[1] + this.data.stats.offsides.A[2]},${this.data.stats.offsides.B[1] + this.data.stats.offsides.B[2]}\n`;
                csv += `Faltas,${this.data.fouls.A.length},${this.data.fouls.B.length}\n`;
                
                const yellowA = this.data.cards.A.filter(c => c.type === 'yellow').length;
                const yellowB = this.data.cards.B.filter(c => c.type === 'yellow').length;
                const redA = this.data.cards.A.filter(c => c.type === 'red').length;
                const redB = this.data.cards.B.filter(c => c.type === 'red').length;
                
                csv += `Tarjetas Amarillas,${yellowA},${yellowB}\n`;
                csv += `Tarjetas Rojas,${redA},${redB}\n`;
                csv += `Cambios,${this.data.substitutions.A.length},${this.data.substitutions.B.length}\n`;
                
                const penalGoalA = this.data.penalties.A.filter(p => p.result === 'goal').length;
                const penalGoalB = this.data.penalties.B.filter(p => p.result === 'goal').length;
                const penalMissA = this.data.penalties.A.filter(p => p.result === 'miss').length;
                const penalMissB = this.data.penalties.B.filter(p => p.result === 'miss').length;
                
                csv += `Penales Anotados,${penalGoalA},${penalGoalB}\n`;
                csv += `Penales Fallados,${penalMissA},${penalMissB}\n`;

                const filename = `estadisticas_${teamAName.replace(/\s+/g, '_')}_vs_${teamBName.replace(/\s+/g, '_')}.csv`;

                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);

                alert('‚úì Estad√≠sticas exportadas en CSV');
            },

            resetAll() {
                if (confirm('¬øEst√° seguro que desea reiniciar completamente el partido? Esta acci√≥n no se puede deshacer.')) {
                    [1, 2].forEach(half => {
                        if (this.data.timers[half].interval) {
                            clearInterval(this.data.timers[half].interval);
                        }
                    });
                    ['A', 'B'].forEach(team => {
                        if (this.data.possession[team].interval) {
                            clearInterval(this.data.possession[team].interval);
                        }
                    });

                    const teamNames = {
                        A: this.data.teams.A.name,
                        B: this.data.teams.B.name
                    };
                    const teamColors = {
                        A: this.data.teams.A.color,
                        B: this.data.teams.B.color
                    };

                    this.data = {
                        version: '1.0',
                        teams: {
                            A: { name: teamNames.A, color: teamColors.A },
                            B: { name: teamNames.B, color: teamColors.B }
                        },
                        score: { A: 0, B: 0 },
                        timers: {
                            1: { seconds: 0, additionSeconds: 0, additionMinutes: 0, running: false, finished: false, interval: null },
                            2: { seconds: 0, additionSeconds: 0, additionMinutes: 0, running: false, finished: false, interval: null }
                        },
                        possession: {
                            A: { seconds: 0, active: false, interval: null },
                            B: { seconds: 0, active: false, interval: null }
                        },
                        stats: {
                            corners: { A: { 1: 0, 2: 0 }, B: { 1: 0, 2: 0 } },
                            offsides: { A: { 1: 0, 2: 0 }, B: { 1: 0, 2: 0 } }
                        },
                        attacks: { A: { 1: [], 2: [] }, B: { 1: [], 2: [] } },
                        goals: { A: { 1: [], 2: [] }, B: { 1: [], 2: [] } },
                        fouls: { A: [], B: [] },
                        cards: { A: [], B: [] },
                        substitutions: { A: [], B: [] },
                        penalties: { 
                            active: false,
                            A: [], 
                            B: [] 
                        }
                    };

                    this.updateAllDisplays();
                    this.save();
                    alert('‚úì Partido reiniciado completamente');
                }
            },

            updateAllDisplays() {
                document.getElementById('teamAName').value = this.data.teams.A.name;
                document.getElementById('teamBName').value = this.data.teams.B.name;
                document.getElementById('teamAColor').value = this.data.teams.A.color;
                document.getElementById('teamBColor').value = this.data.teams.B.color;

                const elementsA = ['scoreNameA', 'possessionNameA', 'attacksNameA1', 'attacksNameA2', 
                                  'goalsNameA1', 'goalsNameA2', 'cornersNameA1', 'cornersNameA2',
                                  'foulsNameA', 'offsidesNameA1', 'offsidesNameA2', 'cardsNameA',
                                  'subsNameA', 'penaltiesNameA'];
                const elementsB = ['scoreNameB', 'possessionNameB', 'attacksNameB1', 'attacksNameB2',
                                  'goalsNameB1', 'goalsNameB2', 'cornersNameB1', 'cornersNameB2',
                                  'foulsNameB', 'offsidesNameB1', 'offsidesNameB2', 'cardsNameB',
                                  'subsNameB', 'penaltiesNameB'];

                elementsA.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = this.data.teams.A.name;
                });
                elementsB.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = this.data.teams.B.name;
                });

                this.updateScoreboard();

                [1, 2].forEach(half => {
                    this.updateTimerDisplay(half);
                    if (this.data.timers[half].finished) {
                        document.getElementById(`start${half}`).style.display = 'none';
                        document.getElementById(`pause${half}`).style.display = 'none';
                        document.getElementById(`finish${half}`).style.display = 'none';
                    } else if (this.data.timers[half].running) {
                        document.getElementById(`start${half}`).style.display = 'none';
                        document.getElementById(`pause${half}`).style.display = 'inline-block';
                        document.getElementById(`finish${half}`).style.display = 'inline-block';
                    } else {
                        document.getElementById(`start${half}`).style.display = 'inline-block';
                        document.getElementById(`pause${half}`).style.display = 'none';
                        document.getElementById(`finish${half}`).style.display = 'none';
                    }
                });

                this.updatePossessionDisplay();
                this.updateAttacksDisplay();
                this.updateStatDisplay('corners');
                this.updateStatDisplay('offsides');
                this.updateGoalsDisplay();
                this.updateFoulsDisplay();
                this.updateCardsDisplay();
                this.updateSubstitutionsDisplay();
                this.updatePenaltiesDisplay();

                if (this.data.penalties.active) {
                    document.getElementById('penaltiesSection').classList.add('active');
                } else {
                    document.getElementById('penaltiesSection').classList.remove('active');
                }

                this.updateTeamColors();
            },

            save() {
                try {
                    sessionStorage.setItem('footballMatchData', JSON.stringify(this.data));
                    this.showSaveIndicator();
                } catch (error) {
                    console.error('Error al guardar:', error);
                }
            },

            loadFromSession() {
                try {
                    const saved = sessionStorage.getItem('footballMatchData');
                    if (saved) {
                        this.data = JSON.parse(saved);
                        this.data.timers[1].interval = null;
                        this.data.timers[2].interval = null;
                        this.data.timers[1].running = false;
                        this.data.timers[2].running = false;
                        this.data.possession.A.interval = null;
                        this.data.possession.B.interval = null;
                        this.data.possession.A.active = false;
                        this.data.possession.B.active = false;
                    }
                } catch (error) {
                    console.error('Error al cargar:', error);
                }
            },

            showSaveIndicator() {
                const indicator = document.getElementById('saveIndicator');
                indicator.classList.add('show');
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 2000);
            },

            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
            },

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }
        };

        window.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
    </script>
</body>
</html>